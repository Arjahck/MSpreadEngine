"""Unit tests for malware engine."""

import unittest
from malware_engine.malware_base import Malware, MalwareType


class TestMalware(unittest.TestCase):
    """Test cases for unified Malware class."""

    def setUp(self):
        """Set up test fixtures."""
        self.malware = Malware("malware_1", infection_rate=0.5)

    def test_creation(self):
        """Test creating a malware instance."""
        self.assertEqual(self.malware.malware_id, "malware_1")
        self.assertEqual(self.malware.infection_rate, 0.5)

    def test_mark_infected(self):
        """Test marking devices as infected."""
        self.malware.mark_infected("device_1")
        self.assertIn("device_1", self.malware.infected_devices)

    def test_get_infected_count(self):
        """Test getting the count of infected devices."""
        self.malware.mark_infected("device_1")
        self.malware.mark_infected("device_2")
        self.assertEqual(self.malware.get_infected_count(), 2)

    def test_behavior_config(self):
        """Test that configuration is correctly reflected."""
        m = Malware("m2", target_os=["Windows"], avoids_admin=True)
        self.assertEqual(m.target_os, ["windows"])
        self.assertTrue(m.avoids_admin)
        
        behavior = m.get_behavior()
        self.assertEqual(behavior["target_os"], ["windows"])
        self.assertEqual(behavior["avoids_admin"], True)


if __name__ == "__main__":
    unittest.main()
